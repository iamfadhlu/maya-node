{{ template "default-state.yaml" }}
---
{{ template "btc-pool-state.yaml" }}
---
type: create-blocks
count: 1
---
type: tx-mimir
key: MAYANameGracePeriodBlocks
value: 5
signer: {{ addr_maya_dog }}
sequence: 0
---
type: create-blocks
count: 1
---
########################################################################################
# Setup mayaname
########################################################################################
type: tx-send
from_address: {{ addr_maya_fox }}
to_address: {{ addr_maya_pig }}
amount:
  - amount: "1500000000000"
    denom: "cacao"
---
type: create-blocks
count: 1
---
type: tx-deposit
signer: {{ addr_maya_pig }}
coins:
  - amount: "110000000000"
    asset: "cacao"
memo: "~:test:MAYA:{{ addr_maya_pig }}:{{ addr_maya_pig }}::10"
---
type: create-blocks
count: 1
---
type: check
endpoint: http://localhost:1317/mayachain/mayaname/test
asserts:
  - .aliases[0].address == "{{ addr_maya_pig }}"
  - .owner == "{{ addr_maya_pig }}"
---
########################################################################################
# Validate ownership while mayaname is valid
########################################################################################
type: tx-send
from_address: {{ addr_maya_fox }}
to_address: {{ addr_maya_dog }}
amount:
  - amount: "150000000000"
    denom: "cacao"
---
type: create-blocks
count: 1
---
type: tx-deposit
signer: {{ addr_maya_dog }}
coins:
  - amount: "110000000000"
    asset: "cacao"
memo: "~:test:MAYA:{{ addr_maya_dog }}:{{ addr_maya_dog }}"
---
type: create-blocks
count: 1
---
type: check
endpoint: http://localhost:1317/mayachain/mayaname/test
asserts:
  - .aliases[0].address == "{{ addr_maya_pig }}"
  - .owner == "{{ addr_maya_pig }}"
  - .expire_block_height == 10
---
########################################################################################
# Fast-forward to expire mayaname registration - block height will be 11 after this step
########################################################################################
type: create-blocks
count: 6
---
########################################################################################
# Name is expired but still exists
########################################################################################
type: check
endpoint: http://localhost:1317/mayachain/mayaname/test
asserts:
  - .aliases[0].address == "{{ addr_maya_pig }}"
  - .owner == "{{ addr_maya_pig }}"
  - .expire_block_height == 10
---
########################################################################################
# Expired but still in-grace mayaname can't be sniped
########################################################################################
type: tx-deposit
signer: {{ addr_maya_dog }}
coins:
  - amount: "110000000000"
    asset: "cacao"
memo: "~:test:MAYA:{{ addr_maya_dog }}:{{ addr_maya_dog }}"
---
type: create-blocks
count: 1
---
type: check
endpoint: http://localhost:1317/mayachain/mayaname/test
asserts:
  - .aliases[0].address == "{{ addr_maya_pig }}"
  - .owner == "{{ addr_maya_pig }}"
---
########################################################################################
# During grace period, mayaname can be re-upped by original owner
########################################################################################  
type: tx-deposit
signer: {{ addr_maya_pig }}
coins:
  - amount: "500000000000"
    asset: "cacao"
memo: "~:test:MAYA:{{ addr_maya_pig }}:{{ addr_maya_pig }}"
---
type: create-blocks
count: 1
---
type: check
endpoint: http://localhost:1317/mayachain/mayaname/test
asserts:
  - .aliases[0].address == "{{ addr_maya_pig }}"
  - .owner == "{{ addr_maya_pig }}"
  - .expire_block_height == 250000014

